@page "{handler?}"
@using Schools.Application.Utilities
@using Schools.Application.Utilities.Convertors
@using Schools.Domain.Models.Users
@model Schools.WebApp.Pages.UserPanel.IndexModel
@{
    ViewData["title"] = $"حساب کاربری {Model.UserModel.Name} {Model.UserModel.Family} ";
    bool isSuccess = TempData["EditSuccess"] != null;
    bool isRegistered = TempData["RegisterSuccess"] != null;
    bool isExistRequest = TempData["RequestExist"] != null;
}
@section Meta
{
    <link rel="stylesheet" type="text/css" href="/css/account.css">
}
@section Topic_Layer
{
    <div class="container page-title">
        <h1><a href="javascript:void(0)"> حساب کاربری </a></h1>
        <ul itemtype="http://schema.org/BreadcrumbList" class="breadcrumb">
            <li itemtype="http://schema.org/ListItem" itemscope="" itemprop="itemListElement"><a href="/" itemprop="item"><span itemprop="name"> بانک اطلاعاتی آموزشگاه ها </span></a></li>
            <li itemtype="http://schema.org/ListItem" itemscope="" itemprop="itemListElement">
                <a href="" itemprop="item" class="current">
                    <span itemprop="name"> حساب کاربری @Model.UserModel.Name @Model.UserModel.Family </span>
                </a>
            </li>
        </ul>
    </div>
}
<div class="account-layer">
    <div class="container">
        @{
            var menuModel = new Tuple<User, string>(Model.UserModel, "Index");
        }
        <partial name="Shared/_RightMenu" model="menuModel" />

        <div class="left-side">
            <div class="account-heading layer-style">
                <span class="status green"> وضعیت : <i> @(Model.UserModel.IsActive ? "فعال" : "غییر فعال") </i></span>
                <a href="/UserPanel/Tickets/Add"> <i class="zmdi zmdi-plus"></i> ثبت تیکت </a>
                <a href="/UserPanel/RegisterSchool" style="background-color: cadetblue !important"> <i class="zmdi zmdi-plus"></i>  ثبت آموزشگاه </a>
            </div>
            <div class="dashboard-box layer-style last-like">
                <h3> آخرین آموزشگاه های پسند شده </h3>
                <div class="inner">
                    @if (Model.UserModel.UserLikes.Count >= 1)
                    {
                        <ul>
                            @foreach (var item in Model.UserModel.UserLikes)
                            {
                                <li><a href="/School/@item.SchoolId/@item.School.SchoolTitle.Replace(" ", "-").Trim()"> @item.School.SchoolTitle <span> (میزان محبوبیت : @item.School.UserLikes.Count نفر) </span></a></li>
                            }

                        </ul>
                    }
                    else
                    {
                        <div class="alert alert-info">
                            <i class="fa fa-info">موردی برای نمایش وجود ندارد</i>
                        </div>
                    }
                </div>
            </div>
            <div class="dashboard-box layer-style">
                <h3> پیام های خصوصی خوانده نشده </h3>
                <div class="inner">
                    <div class="dashboard-message">
                        @foreach (var item in Model.UserModel.ReceiverMessages.Where(m=>m.MessageContents.Any(u=>u.UserId!=User.GetUserId() && u.IsSeen==false)))
                        {
                            <div class="ticket-box layer-style">
                                <div class="head">
                                    <span class="code"> کد پیام : <i>@item.Um_Id</i> </span>
                                    <span class="resgiter-date"> تاریخ ارسال : <i>@item.CreateDate.ToShamsi()</i> </span>
                                </div>

                                <div class="text">
                                    @if (item.SenderId == User.GetUserId())
                                    {
                                        <span>
                                            یک پیام از کاربر @item.Receiver.UserName برای شما ارسال شده است
                                        </span>
                                    }
                                    @if (item.ReceiverId == User.GetUserId())
                                    {
                                        <span>
                                            یک پیام از کاربر @item.Sender.UserName برای شما ارسال شده است
                                        </span>
                                    }
                                    <p>
                                        @item.MessageTitle
                                    </p>
                                    <a href="/UserPanel/Messages/Show/@item.Um_Id"> مشاهده کامل و ثبت پاسخ </a>
                                </div>

                            </div>
                        }

                    </div>
                </div>
            </div>
            <!-- /dashboard -->

        </div>
        <!-- /left side -->
        <div class="clearfix"></div>
    </div>
</div>
@section Scripts
{
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="/js/account.js"></script>
    <script>
        if (@isSuccess.ToString().ToLower())
        {
            swal({
                title: "ویرایش  با موفقیت انجام شد",
                icon: "success",
                button: "باشه"
            });
        }
        if (@isRegistered.ToString().ToLower())
        {
            swal({
                title: "درخواست شما ثبت شد",
                text:"نتیجه از طریق اطلاعیه به شما اعلام می شود",
                icon: "success",
                button: "باشه"
            });
        }
        if (@isExistRequest.ToString().ToLower())
        {
            swal({
                title: "درخواست شما قبلا ثبت شده است",
                text:"برای پیگیری درخواست خود از طریق تیکت اقدام کنید",
                icon: "warning",
                button: "باشه"
            });
        }
    </script>
}
